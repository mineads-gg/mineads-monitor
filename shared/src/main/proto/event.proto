syntax = "proto3";

option java_package = "gg.mineads.monitor.shared.event.generated";
option java_multiple_files = true;
option go_package = "./generated";

package mineadsmonitor.v1;

// LuckPerms data
message LuckPermsData {
  repeated string groups = 1;
}

// Player join data
message PlayerJoinData {
  string session_id = 1;
  string uuid = 2;
  string username = 3;
  optional string host = 5;
  optional int32 protocol_version = 7;
  optional bool online_mode = 8;
  optional LuckPermsData luckperms_data = 9;
  optional string virtual_host = 10;
  optional string skin_texture_hash = 11;
  optional string cape_texture_hash = 12;
  optional string skin_type = 13;
  // Marketing attribution - subdomain player joined through
  optional string tracking_subdomain = 14;
}

// Player ping data - tracks latency
message PlayerPingData {
  string session_id = 1;
  int32 ping_ms = 2;
}

// Player location data - tracks in-game position
message PlayerLocationData {
  string session_id = 1;
  string world = 2;
  double x = 3;
  double y = 4;
  double z = 5;
  optional float yaw = 6;
  optional float pitch = 7;
}

// Player achievement data - tracks unlocked achievements
message PlayerAchievementData {
  string session_id = 1;
  string achievement_key = 2;
  optional string achievement_name = 3;
}

// Player death data - tracks player deaths
message PlayerDeathData {
  string session_id = 1;
  optional string death_message = 2;
  optional string killer_uuid = 3;
  optional string killer_type = 4; // "player", "mob", "environment"
  optional string world = 5;
  optional double x = 6;
  optional double y = 7;
  optional double z = 8;
}

// Player advancement data - tracks advancement progress
message PlayerAdvancementData {
  string session_id = 1;
  string advancement_key = 2;
  optional string advancement_title = 3;
  optional string advancement_description = 4;
  optional string frame_type = 5; // "task", "goal", "challenge"
}

// Player leave data
message PlayerLeaveData {
  string session_id = 1;
}

// Player heartbeat data
message PlayerHeartbeatData {
  repeated string session_ids = 1;
}

// Player chat data
message PlayerChatData {
  string session_id = 1;
  optional string message = 2;
}

// Player command data
message PlayerCommandData {
  string session_id = 1;
  repeated string arguments = 2;
  bool is_truncated = 3;
}

message PlayerSettingsData {
  string session_id = 1;
  optional string locale = 2;
  optional int32 view_distance = 3;
  optional string chat_mode = 4;
  optional bool chat_colors = 5;
  optional string main_hand = 6;
  optional bool text_filtering_enabled = 7;
  optional bool allows_server_listings = 8;
}

message PlayerClientBrandData {
  string session_id = 1;
  optional string client_brand = 2;
}

// Transaction data
message TransactionData {
  string transaction_id = 1;
  // Field 2 (username) removed - now only uuid is sent
  string uuid = 3;
  string package_id = 4;
  double price = 5;
  string currency = 6;
}

// Main event message
message MineAdsEvent {
  int64 time = 2;
  string event_id = 16;

  oneof data {
    PlayerJoinData join_data = 3;
    PlayerLeaveData leave_data = 4;
    PlayerChatData chat_data = 5;
    PlayerCommandData command_data = 6;
    PlayerHeartbeatData heartbeat_data = 8;
    PlayerSettingsData settings_data = 9;
    PlayerClientBrandData client_brand_data = 10;
    TransactionData initial_transaction_data = 11;
    TransactionData expiry_transaction_data = 12;
    TransactionData renewal_transaction_data = 13;
    TransactionData chargeback_transaction_data = 14;
    TransactionData refund_transaction_data = 15;
    // New event types for full analytics support
    PlayerPingData ping_data = 17;
    PlayerLocationData location_data = 18;
    PlayerAchievementData achievement_data = 19;
    PlayerDeathData death_data = 20;
    PlayerAdvancementData advancement_data = 21;
  }
}

message FailedEvent {
  string event_id = 1;
  string error = 2;
}

// Batch of events
message EventBatch {
  repeated MineAdsEvent events = 1;
  string server_id = 2;
}

// Response message for ingestion API
message IngestResponse {
  bool success = 1;
  string error = 2;
  repeated FailedEvent failed_events = 3;
}
